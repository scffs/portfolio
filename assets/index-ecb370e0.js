import{J as e,C as n,_ as a,K as i,j as t,ag as l,m as r,g as o,i as s,P as u,l as c,a0 as v,B as d,O as f,c as p,d as m,e as k,p as w,u as h,S as b,G as _}from"./AppWrapper-679c0da7.js";import{r as S}from"./react-37698f52.js";import{a as g,u as C,b as x}from"./useWaitTransitionFinish-63677e62.js";import{g as V}from"./getNavId-aa412334.js";import{c as B,P as y}from"./App-a302478c.js";import{j as E}from"./index-928f330e.js";import{P as O}from"./PanelHeaderButton-ad2d11fb.js";var P=e("Icon28ArrowLeftOutline","arrow_left_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" id="arrow_left_outline_28"><g fill="none" fill-rule="evenodd"><path d="M28 0H0v28h28z" /><path fill="currentColor" fill-rule="nonzero" d="M12.293 6.293a1 1 0 0 1 1.414 1.414L8.414 13H22a1 1 0 0 1 .993.883L23 14a1 1 0 0 1-1 1H8.414l5.293 5.293a1 1 0 0 1 .083 1.32l-.083.094a1 1 0 0 1-1.414 0l-7-7-.073-.082A1.005 1.005 0 0 1 5 14l.004.09A1.006 1.006 0 0 1 5 14.02V14a1.02 1.02 0 0 1 .125-.484.878.878 0 0 1 .071-.111.999.999 0 0 1 .097-.112l-.08.09c.025-.031.051-.062.08-.09Z" /></g></symbol>',28,28,!1,void 0),W=e("Icon28ChevronBack","chevron_back_28","0 0 20 28",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 28" id="chevron_back_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h20v28H0z" /><path fill="currentColor" d="M4.56 12.94 13 4.5a1.414 1.414 0 0 1 2 2L7.5 14l7.5 7.5a1.414 1.414 0 0 1-2 2l-8.44-8.44a1.5 1.5 0 0 1 0-2.12Z" /></g></symbol>',20,28,!1,void 0),j=e("Icon28ChevronLeftOutline","chevron_left_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="chevron_left_outline_28"><path fill="currentColor" d="m12.414 14 5.793-5.793a1 1 0 0 0-1.414-1.414l-6.5 6.5a1 1 0 0 0 0 1.414l6.5 6.5a1 1 0 0 0 1.414-1.414z" /></symbol>',28,28,!1,void 0),I=S.createContext({entering:!1}),N=function(e){var a=e.children,i=e.entering,t=S.useContext(I),l=n({entering:t.entering||i});return S.createElement(I.Provider,{value:l},a)};var M,T;(T=M||(M={}))[T.fail=1]="fail",T[T.success=2]="success";var X={},A=function(e){var n,h,b=e.activePanel,_=e.history,y=e.nav,E=e.onTransition,O=e.onSwipeBack,P=e.onSwipeBackStart,W=e.onSwipeBackCancel,j=e.children,I=e.className,T=a(e,["activePanel","history","nav","onTransition","onSwipeBack","onSwipeBackStart","onSwipeBackCancel","children","className"]),A=S.useRef(X[V({nav:y,id:T.id})]||{}),H=S.useRef(i);S.useEffect((function(){return function(){var e=V({nav:y,id:T.id});e&&(X[e]=A.current)}}));var z=S.useRef({}),K=t(),L=K.window,R=K.document,F=l(),Z=r(),G=B(),J=o(),q=s(S.useState(!1),2),D=q[0],Q=q[1],U=s(S.useState([b]),2),Y=U[0],$=U[1],ee=s(S.useState(b),2),ne=ee[0],ae=ee[1],ie=s(S.useState(void 0),2),te=ie[0],le=ie[1],re=s(S.useState(null),2),oe=re[0],se=re[1],ue=s(S.useState(null),2),ce=ue[0],ve=ue[1],de=s(S.useState(!1),2),fe=de[0],pe=de[1],me=s(S.useState(!1),2),ke=me[0],we=me[1],he=s(S.useState(0),2),be=he[0],_e=he[1],Se=s(S.useState(0),2),ge=Se[0],Ce=Se[1],xe=s(S.useState(null),2),Ve=xe[0],Be=xe[1],ye=s(S.useState(null),2),Ee=ye[0],Oe=ye[1],Pe=s(S.useState(null),2),We=Pe[0],je=Pe[1],Ie=s(S.useState(!1),2),Ne=Ie[0],Me=Ie[1],Te=g(b),Xe=g(fe),Ae=g(Ne),He=g(We),ze=g(Ee),Ke=g(E),Le=S.Children.toArray(j).filter((function(e){var n=V(e.props);return void 0!==n&&Y.includes(n)||n===Ee||n===Ve})),Re=!1===(null===(n=Z)||void 0===n?void 0:n.transitionMotionEnabled)||!(null===(h=G)||void 0===h?void 0:h.animate)||J===u.VKCOM,Fe=function(e){return null===e?null:z.current[e]},Ze=S.useCallback((function(e,n){n&&(A.current[e]=0),se(null),ve(null),$([b]),ae(b),Q(!1),le(void 0),H.current=function(){var a;null===(a=F)||void 0===a||a.scrollTo(0,n?A.current[b]:0),E&&E({isBack:n,from:e,to:b})}}),[b,E,F]);c((function(){H.current(),H.current=i}),[H.current]);var Ge=S.useCallback((function(e){e&&!["vkuivkui-animation-ios-next-forward","vkuivkui-animation-ios-prev-back","vkuivkui-animation-view-next-forward","vkuivkui-animation-view-prev-back"].includes(e.animationName)||null===oe||Ze(oe,Boolean(te))}),[Ze,te,oe]),Je=C().waitTransitionFinish,qe=v(Ge,J===u.IOS?600:300),De=S.useCallback((function(){O&&O()}),[O]),Qe=S.useCallback((function(){W&&W(),Oe(null),Be(null),pe(!1),je(null),_e(0),Ce(0)}),[W]),Ue=S.useCallback((function(e){var n,a;if(!e||(null===(n=e)||void 0===n?void 0:n.propertyName.includes("transform"))&&(null===(a=e)||void 0===a?void 0:a.target)===Fe(Ve))switch(We){case M.fail:Qe();break;case M.success:De()}}),[Qe,De,Ve,We]),Ye=S.useCallback((function(e){if(fe){var n,a=ge/e.duration*1e3;0===ge?Qe():ge>=(null!==(n=L.innerWidth)&&void 0!==n?n:0)?De():a>250||be+ge>L.innerWidth/2?je(M.success):je(M.fail)}ke&&we(!1)}),[Qe,De,ge,be,fe,ke,L]),$e=function(e){if(!w||!L)return{};var n=e===Ee,a=e===Ve;if(!n&&!a||We)return{};var i="".concat(ge,"px"),t="".concat(100*ge/L.innerWidth/2-50,"%"),l=.3*(L.innerWidth-ge)/L.innerWidth;return We?n?{boxShadow:"-2px 0 12px rgba(0, 0, 0, ".concat(l,")")}:{}:a?{transform:"translate3d(".concat(t,", 0, 0)"),WebkitTransform:"translate3d(".concat(t,", 0, 0)")}:n?{transform:"translate3d(".concat(i,", 0, 0)"),WebkitTransform:"translate3d(".concat(i,", 0, 0)"),boxShadow:"-2px 0 12px rgba(0, 0, 0, ".concat(l,")")}:{}};return S.useEffect((function(){if(Te&&Te!==b&&!Xe&&!Ae){var e,n=S.Children.toArray(j).map((function(e){return V(e.props)})).find((function(e){return e===Te||e===b}))===b;A.current[Te]=null===(e=F)||void 0===e?void 0:e.getScroll().y,Re?Ze(Te,n):(d(R),$([Te,b]),se(Te),ve(b),ae(null),Q(!0),le(n),x.supported||qe.set())}if(Te&&Te!==b&&Xe){var a=b,i=Te;ze&&(A.current[ze]=0),Oe(null),Be(null),pe(!1),je(null),_e(0),Ce(0),ae(a),$([a]),H.current=function(){var e;null!==a&&(null===(e=F)||void 0===e||e.scrollTo(0,A.current[a]));Ke&&Ke({isBack:!0,from:i,to:a})}}var t;(!He&&We&&Je(Fe(Ve),Ue,J===u.IOS?600:300),He!==M.fail||We||null===ne)||(null===(t=F)||void 0===t||t.scrollTo(0,A.current[ne]));Te!==b&&Ne&&(Me(!1),ve(null),se(null),Q(!1),$([b]),ae(b))}),[b,ne,qe,Ne,j,Re,R,Ze,P,Le,J,Te,Ae,Ke,ze,He,Xe,F,Ve,We,fe,Ue,Je]),S.createElement(f,p(k({Component:"section"},T),{className:m("vkuiView",J===u.IOS&&m("vkuiView--ios","vkuiInternalView--ios"),!Re&&D&&"vkuiView--animated",!Re&&fe&&"vkuiView--swiping-back",Re&&"vkuiView--no-motion",I),onMoveX:function(e){var n,a,i,t,l;if(!(J!==u.IOS||ke||(a=e,l=a.originalEvent.target,Boolean(null===(t=l)||void 0===t||null===(i=t.closest)||void 0===i?void 0:i.call(t,"input, textarea, [data-vkui-swipe-back=false]")))||Re))if(null===(n=Z)||void 0===n?void 0:n.isWebView){if(O&&!(D&&e.startX<=70)){if(!fe&&e.startX<=70&&_&&_.length>1){var r;if(P)if("prevent"===P(ne))return void we(!0);if(null!==ne)d(R),A.current[ne]=null===(r=F)||void 0===r?void 0:r.getScroll().y;pe(!0),_e(e.startX),Oe(ne),Be(_.slice(-2)[0])}if(fe){var o=0;o=e.shiftX<0?0:e.shiftX>L.innerWidth-be?L.innerWidth:e.shiftX,Ce(o)}}}else(e.startX<=70||e.startX>=L.innerWidth-70)&&!Ne&&Me(!0)},onEnd:Ye}),S.createElement("div",{className:"vkuiView__panels"},Le.map((function(e){var n,a=V(e.props),i=D&&a===(te?oe:ce),t=a===oe||a===Ee||a===Ve||a===ce&&te;return S.createElement("div",{className:m("vkuiView__panel",a===ne&&"vkuiView__panel--active",a===oe&&"vkuiView__panel--prev",a===ce&&"vkuiView__panel--next",a===Ee&&"vkuiView__panel--swipe-back-prev",a===Ve&&"vkuiView__panel--swipe-back-next",We===M.success&&"vkuiView__panel--swipe-back-success",We===M.fail&&"vkuiView__panel--swipe-back-failed"),onAnimationEnd:i?Ge:void 0,ref:function(e){return void 0!==a&&(z.current[a]=e)},style:$e(a),key:a},S.createElement("div",{className:"vkuiView__panel-in",style:{marginTop:t?-(null!==(n=A.current[a])&&void 0!==n?n:0):void 0}},S.createElement(N,{entering:a===ce||a===Ve},e)))}))))},H=function(e){var n=e.label,i=e["aria-label"],t=void 0===i?"Назад":i,l=e.className,r=a(e,["label","aria-label","className"]),s=o(),c=h().sizeX,v=void 0===c?"none":c,d=s===u.VKCOM||s===u.IOS,f=S.createElement(P,null);switch(s){case u.IOS:f=S.createElement(W,null);break;case u.VKCOM:f=S.createElement(j,null)}return S.createElement(O,p(k({},r),{className:m(v===b.COMPACT&&"vkuiPanelHeaderBack--sizeX-compact",s===u.IOS&&"vkuiPanelHeaderBack--ios",s===u.VKCOM&&"vkuiPanelHeaderBack--vkcom",d&&!!n&&"vkuiPanelHeaderBack--has-label",l),label:d&&n,"aria-label":t}),f)};const z=({title:e})=>{const n=_();return E.jsx(y,{before:E.jsx(H,{onClick:()=>n.back()}),children:e})};export{z as P,A as V};
