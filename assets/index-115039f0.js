import{L as e,C as n,_ as a,M as i,j as t,ai as l,m as r,g as o,i as s,P as u,l as c,a2 as v,B as d,U as f,c as m,d as k,e as p,p as w,u as h,S as b,H as _,I as S}from"./index-99b15b47.js";import{r as g}from"./react-37698f52.js";import{a as C,u as x,b as V}from"./useWaitTransitionFinish-e4f41df5.js";import{g as B}from"./getNavId-aa412334.js";import{c as y,P as E}from"./App-e440e7c4.js";import{P as O}from"./PanelHeaderButton-a5396a9b.js";var I=e("Icon28ArrowLeftOutline","arrow_left_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" id="arrow_left_outline_28"><g fill="none" fill-rule="evenodd"><path d="M28 0H0v28h28z" /><path fill="currentColor" fill-rule="nonzero" d="M12.293 6.293a1 1 0 0 1 1.414 1.414L8.414 13H22a1 1 0 0 1 .993.883L23 14a1 1 0 0 1-1 1H8.414l5.293 5.293a1 1 0 0 1 .083 1.32l-.083.094a1 1 0 0 1-1.414 0l-7-7-.073-.082A1.005 1.005 0 0 1 5 14l.004.09A1.006 1.006 0 0 1 5 14.02V14a1.02 1.02 0 0 1 .125-.484.878.878 0 0 1 .071-.111.999.999 0 0 1 .097-.112l-.08.09c.025-.031.051-.062.08-.09Z" /></g></symbol>',28,28,!1,void 0),P=e("Icon28ChevronBack","chevron_back_28","0 0 20 28",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 28" id="chevron_back_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h20v28H0z" /><path fill="currentColor" d="M4.56 12.94 13 4.5a1.414 1.414 0 0 1 2 2L7.5 14l7.5 7.5a1.414 1.414 0 0 1-2 2l-8.44-8.44a1.5 1.5 0 0 1 0-2.12Z" /></g></symbol>',20,28,!1,void 0),M=e("Icon28ChevronLeftOutline","chevron_left_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="chevron_left_outline_28"><path fill="currentColor" d="m12.414 14 5.793-5.793a1 1 0 0 0-1.414-1.414l-6.5 6.5a1 1 0 0 0 0 1.414l6.5 6.5a1 1 0 0 0 1.414-1.414z" /></symbol>',28,28,!1,void 0),N=g.createContext({entering:!1}),W=function(e){var a=e.children,i=e.entering,t=g.useContext(N),l=n({entering:t.entering||i});return g.createElement(N.Provider,{value:l},a)};var T,X;(X=T||(T={}))[X.fail=1]="fail",X[X.success=2]="success";var H={},j=function(e){var n,h,b=e.activePanel,_=e.history,S=e.nav,E=e.onTransition,O=e.onSwipeBack,I=e.onSwipeBackStart,P=e.onSwipeBackCancel,M=e.children,N=e.className,X=a(e,["activePanel","history","nav","onTransition","onSwipeBack","onSwipeBackStart","onSwipeBackCancel","children","className"]),j=g.useRef(H[B({nav:S,id:X.id})]||{}),A=g.useRef(i);g.useEffect((function(){return function(){var e=B({nav:S,id:X.id});e&&(H[e]=j.current)}}));var z=g.useRef({}),L=t(),K=L.window,R=L.document,F=l(),Z=r(),U=y(),q=o(),D=s(g.useState(!1),2),G=D[0],J=D[1],Q=s(g.useState([b]),2),Y=Q[0],$=Q[1],ee=s(g.useState(b),2),ne=ee[0],ae=ee[1],ie=s(g.useState(void 0),2),te=ie[0],le=ie[1],re=s(g.useState(null),2),oe=re[0],se=re[1],ue=s(g.useState(null),2),ce=ue[0],ve=ue[1],de=s(g.useState(!1),2),fe=de[0],me=de[1],ke=s(g.useState(!1),2),pe=ke[0],we=ke[1],he=s(g.useState(0),2),be=he[0],_e=he[1],Se=s(g.useState(0),2),ge=Se[0],Ce=Se[1],xe=s(g.useState(null),2),Ve=xe[0],Be=xe[1],ye=s(g.useState(null),2),Ee=ye[0],Oe=ye[1],Ie=s(g.useState(null),2),Pe=Ie[0],Me=Ie[1],Ne=s(g.useState(!1),2),We=Ne[0],Te=Ne[1],Xe=C(b),He=C(fe),je=C(We),Ae=C(Pe),ze=C(Ee),Le=C(E),Ke=g.Children.toArray(M).filter((function(e){var n=B(e.props);return void 0!==n&&Y.includes(n)||n===Ee||n===Ve})),Re=!1===(null===(n=Z)||void 0===n?void 0:n.transitionMotionEnabled)||!(null===(h=U)||void 0===h?void 0:h.animate)||q===u.VKCOM,Fe=function(e){return null===e?null:z.current[e]},Ze=g.useCallback((function(e,n){n&&(j.current[e]=0),se(null),ve(null),$([b]),ae(b),J(!1),le(void 0),A.current=function(){var a;null===(a=F)||void 0===a||a.scrollTo(0,n?j.current[b]:0),E&&E({isBack:n,from:e,to:b})}}),[b,E,F]);c((function(){A.current(),A.current=i}),[A.current]);var Ue=g.useCallback((function(e){e&&!["vkuivkui-animation-ios-next-forward","vkuivkui-animation-ios-prev-back","vkuivkui-animation-view-next-forward","vkuivkui-animation-view-prev-back"].includes(e.animationName)||null===oe||Ze(oe,Boolean(te))}),[Ze,te,oe]),qe=x().waitTransitionFinish,De=v(Ue,q===u.IOS?600:300),Ge=g.useCallback((function(){O&&O()}),[O]),Je=g.useCallback((function(){P&&P(),Oe(null),Be(null),me(!1),Me(null),_e(0),Ce(0)}),[P]),Qe=g.useCallback((function(e){var n,a;if(!e||(null===(n=e)||void 0===n?void 0:n.propertyName.includes("transform"))&&(null===(a=e)||void 0===a?void 0:a.target)===Fe(Ve))switch(Pe){case T.fail:Je();break;case T.success:Ge()}}),[Je,Ge,Ve,Pe]),Ye=g.useCallback((function(e){if(fe){var n,a=ge/e.duration*1e3;0===ge?Je():ge>=(null!==(n=K.innerWidth)&&void 0!==n?n:0)?Ge():a>250||be+ge>K.innerWidth/2?Me(T.success):Me(T.fail)}pe&&we(!1)}),[Je,Ge,ge,be,fe,pe,K]),$e=function(e){if(!w||!K)return{};var n=e===Ee,a=e===Ve;if(!n&&!a||Pe)return{};var i="".concat(ge,"px"),t="".concat(100*ge/K.innerWidth/2-50,"%"),l=.3*(K.innerWidth-ge)/K.innerWidth;return Pe?n?{boxShadow:"-2px 0 12px rgba(0, 0, 0, ".concat(l,")")}:{}:a?{transform:"translate3d(".concat(t,", 0, 0)"),WebkitTransform:"translate3d(".concat(t,", 0, 0)")}:n?{transform:"translate3d(".concat(i,", 0, 0)"),WebkitTransform:"translate3d(".concat(i,", 0, 0)"),boxShadow:"-2px 0 12px rgba(0, 0, 0, ".concat(l,")")}:{}};return g.useEffect((function(){if(Xe&&Xe!==b&&!He&&!je){var e,n=g.Children.toArray(M).map((function(e){return B(e.props)})).find((function(e){return e===Xe||e===b}))===b;j.current[Xe]=null===(e=F)||void 0===e?void 0:e.getScroll().y,Re?Ze(Xe,n):(d(R),$([Xe,b]),se(Xe),ve(b),ae(null),J(!0),le(n),V.supported||De.set())}if(Xe&&Xe!==b&&He){var a=b,i=Xe;ze&&(j.current[ze]=0),Oe(null),Be(null),me(!1),Me(null),_e(0),Ce(0),ae(a),$([a]),A.current=function(){var e;null!==a&&(null===(e=F)||void 0===e||e.scrollTo(0,j.current[a]));Le&&Le({isBack:!0,from:i,to:a})}}var t;(!Ae&&Pe&&qe(Fe(Ve),Qe,q===u.IOS?600:300),Ae!==T.fail||Pe||null===ne)||(null===(t=F)||void 0===t||t.scrollTo(0,j.current[ne]));Xe!==b&&We&&(Te(!1),ve(null),se(null),J(!1),$([b]),ae(b))}),[b,ne,De,We,M,Re,R,Ze,I,Ke,q,Xe,je,Le,ze,Ae,He,F,Ve,Pe,fe,Qe,qe]),g.createElement(f,m(p({Component:"section"},X),{className:k("vkuiView",q===u.IOS&&k("vkuiView--ios","vkuiInternalView--ios"),!Re&&G&&"vkuiView--animated",!Re&&fe&&"vkuiView--swiping-back",Re&&"vkuiView--no-motion",N),onMoveX:function(e){var n,a,i,t,l;if(!(q!==u.IOS||pe||(a=e,l=a.originalEvent.target,Boolean(null===(t=l)||void 0===t||null===(i=t.closest)||void 0===i?void 0:i.call(t,"input, textarea, [data-vkui-swipe-back=false]")))||Re))if(null===(n=Z)||void 0===n?void 0:n.isWebView){if(O&&!(G&&e.startX<=70)){if(!fe&&e.startX<=70&&_&&_.length>1){var r;if(I)if("prevent"===I(ne))return void we(!0);if(null!==ne)d(R),j.current[ne]=null===(r=F)||void 0===r?void 0:r.getScroll().y;me(!0),_e(e.startX),Oe(ne),Be(_.slice(-2)[0])}if(fe){var o=0;o=e.shiftX<0?0:e.shiftX>K.innerWidth-be?K.innerWidth:e.shiftX,Ce(o)}}}else(e.startX<=70||e.startX>=K.innerWidth-70)&&!We&&Te(!0)},onEnd:Ye}),g.createElement("div",{className:"vkuiView__panels"},Ke.map((function(e){var n,a=B(e.props),i=G&&a===(te?oe:ce),t=a===oe||a===Ee||a===Ve||a===ce&&te;return g.createElement("div",{className:k("vkuiView__panel",a===ne&&"vkuiView__panel--active",a===oe&&"vkuiView__panel--prev",a===ce&&"vkuiView__panel--next",a===Ee&&"vkuiView__panel--swipe-back-prev",a===Ve&&"vkuiView__panel--swipe-back-next",Pe===T.success&&"vkuiView__panel--swipe-back-success",Pe===T.fail&&"vkuiView__panel--swipe-back-failed"),onAnimationEnd:i?Ue:void 0,ref:function(e){return void 0!==a&&(z.current[a]=e)},style:$e(a),key:a},g.createElement("div",{className:"vkuiView__panel-in",style:{marginTop:t?-(null!==(n=j.current[a])&&void 0!==n?n:0):void 0}},g.createElement(W,{entering:a===ce||a===Ve},e)))}))))},A=function(e){var n=e.label,i=e["aria-label"],t=void 0===i?"Назад":i,l=e.className,r=a(e,["label","aria-label","className"]),s=o(),c=h().sizeX,v=void 0===c?"none":c,d=s===u.VKCOM||s===u.IOS,f=g.createElement(I,null);switch(s){case u.IOS:f=g.createElement(P,null);break;case u.VKCOM:f=g.createElement(M,null)}return g.createElement(O,m(p({},r),{className:k(v===b.COMPACT&&"vkuiPanelHeaderBack--sizeX-compact",s===u.IOS&&"vkuiPanelHeaderBack--ios",s===u.VKCOM&&"vkuiPanelHeaderBack--vkcom",d&&!!n&&"vkuiPanelHeaderBack--has-label",l),label:d&&n,"aria-label":t}),f)};const z=({title:e})=>{const n=_();return S.jsx(E,{before:S.jsx(A,{onClick:()=>n.back()}),children:e})};export{z as P,j as V};
