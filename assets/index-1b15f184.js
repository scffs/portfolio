var t=Object.defineProperty,e=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(e,n,o)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,l=(t,e)=>{for(var n in e||(e={}))i.call(e,n)&&s(t,n,e[n]);if(o)for(var n of o(e))a.call(e,n)&&s(t,n,e[n]);return t},r=(t,o)=>e(t,n(o)),d=(t,e)=>{var n={};for(var s in t)i.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&o)for(var s of o(t))e.indexOf(s)<0&&a.call(t,s)&&(n[s]=t[s]);return n},c=(t,e,n)=>(s(t,"symbol"!=typeof e?e+"":e,n),n);import{O as u,A as p,d as h,U as m,X as v,i as g,h as M,o as f,C as E,Y as y,P as S,Z as x,$ as w,a0 as C,c as T,a1 as O,f as P,a2 as _,z as b,a3 as A}from"./AppWrapper-57d4a081.js";import{q as Y,h as k,F as R,p as F,y as H,_ as D,s as j,T as L,O as I,f as G,g as q,M as $,b as z,o as N}from"./index-be53575a.js";import{b as B,g as W,c as U,d as X,e as V,t as Z,m as J,f as K,M as Q,a as tt}from"./App-6a17e3f9.js";import{g as et,t as nt,u as ot,a as it}from"./useWaitTransitionFinish-c56c6461.js";import{F as at,w as st}from"./FocusTrap-b2106a9b.js";import{a as lt}from"./AppearanceProvider-695b2498.js";function rt(t){return"function"==typeof t}function dt(t,e){return null!=t?t:e}const ct=()=>{const{viewWidth:t,viewHeight:e,sizeX:n,sizeY:o,hasPointer:i,hasHover:a}=Y(p),s=h(),l=B(),[[r,d],c]=k((()=>[dt(t,W(l)),dt(e,U(l))])),u=R((()=>{const l=dt(i,m),c=dt(a,v),u=dt(t,r),p=dt(e,d);return{viewWidth:u,viewHeight:p,sizeX:dt(n,X(u)),sizeY:dt(o,V(u,p,l)),hasPointer:l,hasHover:c,isDesktop:Z(u,p,l,s)}}),[r,d,t,e,n,o,i,a,s]);return F((()=>{const n=()=>{c((n=>{const o=dt(t,W(l)),i=dt(e,U(l)),[a,s]=n;return a!==o||s!==i?[o,i]:n}))};return t||[l.desktopPlus,l.tablet,l.smallTablet,l.mobile].forEach((t=>J(t,n))),e||[l.mediumHeight,l.mobileLandscapeHeight].forEach((t=>J(t,n))),()=>{[l.desktopPlus,l.tablet,l.smallTablet,l.mobile,l.mediumHeight,l.mobileLandscapeHeight].forEach((t=>K(t,n)))}}),[l,t,e]),u};var ut,pt;function ht(t,e){if("setActive"===e.type&&e.id!==t.activeModal){const n=e.id,o=t.exitingModal||t.activeModal;let i=t.history?[...t.history]:[];const a=Boolean(n&&i.includes(n));return null===n?i=[]:a?i=i.splice(0,i.indexOf(n)+1):i.push(n),{activeModal:n,enteringModal:null,exitingModal:o,history:i,isBack:a}}return"entered"===e.type&&e.id===t.enteringModal?r(l({},t),{enteringModal:null}):"exited"===e.type&&e.id===t.exitingModal?r(l({},t),{exitingModal:null}):"inited"===e.type&&e.id===t.activeModal?r(l({},t),{enteringModal:e.id}):t}function mt(t,e,n=f,o=f,i=f,a=f,s=f){const d=D({}).current;(function(t){return I.toArray(t)})(e).forEach((t=>{const e=t.props,n=et(e),o=void 0!==n&&d[n]||{id:null!=n?n:null};o.onOpen=t.props.onOpen,o.onOpened=t.props.onOpened,o.onClose=t.props.onClose,o.onClosed=t.props.onClosed,"number"==typeof e.settlingHeight&&(o.settlingHeight=e.settlingHeight),null!==o.id&&(d[o.id]=o)}));const c=t&&!d[t]?null:t,[u,p]=j(ht,{activeModal:c,enteringModal:null,exitingModal:null,history:c?[c]:[],isBack:!1});M((()=>{p({type:"setActive",id:null!=c?c:null})}),[t]),M((()=>{u.activeModal&&(s(d[u.activeModal]),p({type:"inited",id:u.activeModal}))}),[u.activeModal]);const h=t=>{var e;return null!=t&&(null==(e=d[t])?void 0:e.type)===ut.CARD},m=L((t=>{if(t){const e=d[t];rt(e.onOpened)?e.onOpened():rt(o)&&o(t)}p({type:"entered",id:t})}),[d,o]),v=L((t=>{if(t){const e=d[t];rt(e.onClosed)?e.onClosed():rt(a)&&a(t)}p({type:"exited",id:t})}),[d,a]),g=Boolean(u.exitingModal&&(h(t)||h(u.exitingModal))),E=L((t=>t?d[t]:void 0),[d]);return r(l({onEnter:function(){const t=u.activeModal&&d[u.activeModal];t&&(rt(t.onOpen)?t.onOpen():rt(n)&&t.id&&n(t.id))},onEntered:m,onExit:function(){const t=u.activeModal&&d[u.activeModal];t&&(rt(t.onClose)?t.onClose():rt(i)&&t.id&&i(t.id))},onExited:v},u),{delayEnter:g,getModalState:E})}(pt=ut||(ut={})).PAGE="page",pt.CARD="card";const vt="_ModalRoot_j6pv1_1",gt="_ModalRoot__mask_j6pv1_6",Mt="_ModalRoot--touched_j6pv1_22",ft="_ModalRoot--switching_j6pv1_26",Et="_ModalRoot__viewport_j6pv1_31",yt="_ModalRoot--desktop_j6pv1_40",St="_ModalRoot--hasCustomPanelHeaderAfterSlot_j6pv1_44",xt="_ModalRoot__modal_j6pv1_50",wt=st("ModalRoot");function Ct(t,e){return!!e&&(t>=e[0]&&t<=e[1])}function Tt(t){return w(t,0,98)}const Ot=function(t,e,n){return function(o){const i=Y(e);return H(t,r(l({},o),{[n]:i}))}}((Pt=y(function(t=f){return function(e){return function(n){const o=mt(n.activeModal,n.children,n.onOpen,n.onOpened,n.onClose,n.onClosed,t);return H(e,l(l({},n),o))}}}((function(t){switch(t.type){case ut.PAGE:return t.settlingHeight=t.settlingHeight||75,_t(t);case ut.CARD:return function(t){t.translateY=0}(t)}}))(class extends G{constructor(t){super(t),c(this,"documentScrolling",!1),c(this,"maskElementRef"),c(this,"viewportRef",q()),c(this,"maskAnimationFrame"),c(this,"modalRootContext"),c(this,"frameIds"),c(this,"restoreFocusTo"),c(this,"preventTouch",(t=>{if(!t)return!1;for(;t.originalEvent;)t=t.originalEvent;return t.preventDefault&&t.preventDefault(),!1})),c(this,"updateModalHeight",(()=>{const t=this.props.getModalState(this.props.activeModal);t&&t.type===ut.PAGE&&(this.props.enteringModal?this.waitTransitionFinish(t,(()=>{requestAnimationFrame((()=>this.checkPageContentHeight()))})):requestAnimationFrame((()=>this.checkPageContentHeight())))})),c(this,"onTouchMove",(t=>{if(this.props.exitingModal)return;const e=this.props.getModalState(this.props.activeModal);return e?e.type===ut.PAGE?this.onPageTouchMove(t,e):e.type===ut.CARD?this.onCardTouchMove(t,e):void 0:void 0})),c(this,"onTouchEnd",(t=>{const e=this.props.getModalState(this.props.activeModal);return(null==e?void 0:e.type)===ut.PAGE?this.onPageTouchEnd(t,e):(null==e?void 0:e.type)===ut.CARD?this.onCardTouchEnd(t,e):void 0})),c(this,"onScroll",(t=>{var e;const n=this.props.activeModal,o=t.target;if(!n)return;const i=this.props.getModalState(n);(null==i?void 0:i.type)===ut.PAGE&&(null==(e=null==i?void 0:i.contentElement)?void 0:e.contains(o))&&(i.contentScrolled=!0,i.contentScrollStopTimeout&&clearTimeout(i.contentScrollStopTimeout),i.contentScrollStopTimeout=setTimeout((()=>{i.contentScrolled&&(i.contentScrolled=!1)}),250))})),this.state={touchDown:!1,dragging:!1,modalOpenedLog:[]},this.maskElementRef=q(),this.modalRootContext={updateModalHeight:this.updateModalHeight,registerModal:t=>{var e,n=t,{id:o}=n,i=d(n,["id"]);return Object.assign(null!=(e=this.props.getModalState(o))?e:{},i)},onClose:()=>this.props.onExit(),isInsideModal:!0},this.frameIds={}}get timeout(){return this.props.platform===S.IOS?400:320}get document(){return this.props.document}get window(){return this.props.window}getModals(){return I.toArray(this.props.children)}componentDidMount(){var t;null==(t=this.window)||t.addEventListener("resize",this.updateModalHeight,!1)}componentWillUnmount(){this.toggleDocumentScrolling(!0),this.window.removeEventListener("resize",this.updateModalHeight,!1)}componentDidUpdate(t){if(this.props.exitingModal&&this.props.exitingModal!==t.exitingModal&&this.closeModal(this.props.exitingModal),this.props.enteringModal&&this.props.enteringModal!==t.enteringModal){const{enteringModal:t}=this.props,e=this.props.getModalState(t);this.props.onEnter(),this.waitTransitionFinish(e,(()=>{(null==e?void 0:e.innerElement)&&(e.innerElement.style.transitionDelay=""),this.props.onEntered(t)})),(null==e?void 0:e.innerElement)&&(e.innerElement.style.transitionDelay=this.props.delayEnter?`${this.timeout}ms`:"",this.animateTranslate(e,e.translateY),this.setMaskOpacity(e,1))}this.props.activeModal&&!t.activeModal&&(this.restoreFocusTo=this.document.activeElement),this.props.activeModal||this.props.exitingModal||!this.restoreFocusTo||(this.restoreFocusTo.focus(),this.restoreFocusTo=null),this.toggleDocumentScrolling(!this.props.activeModal&&!this.props.exitingModal)}toggleDocumentScrolling(t){this.documentScrolling!==t&&(this.documentScrolling=t,t?(this.document.documentElement.classList.remove("vkui--disable-overscroll-behavior"),this.window.removeEventListener("touchmove",this.preventTouch,{passive:!1})):(this.document.documentElement.classList.add("vkui--disable-overscroll-behavior"),this.window.addEventListener("touchmove",this.preventTouch,{passive:!1})))}checkPageContentHeight(){const t=this.props.getModalState(this.props.activeModal);if((null==t?void 0:t.type)===ut.PAGE&&(null==t?void 0:t.modalElement)){const e=l({},t);_t(t);const n=l({},t);let o=!1;e.expandable===n.expandable?e.translateYFrom!==n.translateYFrom&&(o=!0):o=!0,o&&this.animateTranslate(t,t.translateY)}}closeModal(t){var e,n,o;this.setState({touchDown:!1});const i=this.props.getModalState(t);if(!i)return void(t&&wt(`closeActiveModal: модальное окно (страница) ${t} не существует`,"error"));this.state.modalOpenedLog.length||this.setState((e=>({modalOpenedLog:[...e.modalOpenedLog,t]})));const a=this.props.getModalState(this.props.activeModal),s=!!a&&a.type===ut.PAGE,l=!!i&&i.type===ut.PAGE;this.waitTransitionFinish(i,(()=>this.props.onExited(t)));const r=l&&s&&(null!=(e=i.translateY)?e:0)<=(null!=(n=null==a?void 0:a.translateYFrom)?n:0)&&!this.props.isBack?(null!=(o=null==a?void 0:a.translateYFrom)?o:0)+10:100;this.animateTranslate(i,r),a?a.id&&!this.state.modalOpenedLog.includes(a.id)&&(a.translateY=void 0,this.setState((t=>({modalOpenedLog:[...t.modalOpenedLog,a.id]})))):(this.setMaskOpacity(i,0),this.setState({modalOpenedLog:[]}),i.translateY=void 0)}onPageTouchMove(t,e){var n,o,i,a,s,l;const{shiftY:r,originalEvent:d}=t,c=d.target;if(!t.isY)return void((null==(n=this.viewportRef.current)?void 0:n.contains(c))&&d.preventDefault());if(!(null==(o=e.innerElement)?void 0:o.contains(c)))return d.preventDefault();d.stopPropagation();const{expandable:u,contentScrolled:p,collapsed:h,expanded:m}=e;if(this.state.touchDown||(e.touchStartContentScrollTop=null!=(a=null==(i=e.contentElement)?void 0:i.scrollTop)?a:0,this.setState({touchDown:!0})),!p&&(null===e.touchMovePositive&&(e.touchMovePositive=r>0),!e.expandable||h||m&&e.touchMovePositive&&0===e.touchStartContentScrollTop||(null==(s=e.headerElement)?void 0:s.contains(c)))){if(d.preventDefault(),!u&&r<0||!this.window)return;!this.state.dragging&&this.setState({dragging:!0});const t=r/this.window.innerHeight*100,n=x(t,72,.8,this.props.platform!==S.IOS);e.touchShiftYPercent=t,e.translateYCurrent=Tt((null!=(l=e.translateY)?l:0)+n),this.animateTranslate(e,e.translateYCurrent),this.setMaskOpacity(e)}}onCardTouchMove(t,e){var n,o;const{originalEvent:i,shiftY:a}=t,s=i.target;if(null==(n=e.innerElement)?void 0:n.contains(s)){this.state.touchDown||this.setState({touchDown:!0,dragging:!0});const t=a/e.innerElement.offsetHeight*100,n=x(t,72,1.2,this.props.platform!==S.IOS);e.touchShiftYPercent=t,e.translateYCurrent=Math.max(0,(null!=(o=e.translateY)?o:0)+n),this.animateTranslate(e,e.translateYCurrent),this.setMaskOpacity(e)}}onPageTouchEnd(t,e){var n,o,i,a,s,l;const{startY:r,shiftY:d}=t;let c;if(e.contentScrolled=!1,e.touchMovePositive=null,this.state.dragging&&this.window){const u=(r+d)/this.window.innerHeight*100;let p=null!=(n=e.translateYCurrent)?n:0;p=Tt(p+p/t.duration*240*.6*((null!=(o=e.touchShiftYPercent)?o:0)<0?-1:1)),p=100!==e.settlingHeight?Ct(p,e.expandedRange)?null!=(a=null==(i=e.expandedRange)?void 0:i[0])?a:0:Ct(p,e.collapsedRange)?null!=(s=e.translateYFrom)?s:0:Ct(p,e.hiddenRange)?100:null!=(l=e.translateYFrom)?l:0:Ct(p,[0,25])?0:100,100!==p&&u>=75&&(p=100),e.translateY=p,e.translateYCurrent=p,e.collapsed=Ct(p,e.collapsedRange),e.expanded=0===p,e.hidden=100===p,e.hidden&&this.props.onExit(),c=()=>{e.hidden||this.animateTranslate(e,e.translateY),this.setMaskOpacity(e)}}this.setState({touchDown:!1,dragging:!1},c)}onCardTouchEnd({duration:t},e){var n,o;let i;if(this.state.dragging){let a=null!=(n=e.translateYCurrent)?n:0;const s=a/t*240*.6*((null!=(o=e.touchShiftYPercent)?o:0)<0?-1:1);a=Math.max(0,a+s),a=a>=30?100:0,e.translateY=a,e.hidden=100===a,e.hidden&&this.props.onExit(),i=()=>{e.hidden||this.animateTranslate(e,e.translateY),this.setMaskOpacity(e)}}this.setState({touchDown:!1,dragging:!1},i)}waitTransitionFinish(t,e){var n;if(nt.supported){const o=()=>{var n;null==(n=null==t?void 0:t.innerElement)||n.removeEventListener(nt.name,o),e()};null==(n=null==t?void 0:t.innerElement)||n.addEventListener(nt.name,o)}else setTimeout(e,this.timeout)}animateTranslate(t,e){const n=`animateTranslateFrame${t.id}`;cancelAnimationFrame(this.frameIds[n]),this.frameIds[n]=requestAnimationFrame((()=>{var n,o;n=t.innerElement,o=`translate3d(0, ${e}%, 0)`,n&&(n.style.transform=o,n.style.webkitTransform=o)}))}setMaskOpacity(t,e=null){var n;null===e&&(null==(n=this.props.history)?void 0:n[0])!==t.id||(this.maskAnimationFrame&&cancelAnimationFrame(this.maskAnimationFrame),this.maskAnimationFrame=requestAnimationFrame((()=>{if(this.maskElementRef.current){const{translateY:n=0,translateYCurrent:o=0}=t,i=null===e?1-(o-n)/(100-n)||0:e;this.maskElementRef.current.style.opacity=w(i,0,100).toString(),this.maskElementRef.current.style.transitionDelay=i&&this.props.delayEnter?`${this.timeout}ms`:""}})))}render(){var t;const{activeModal:e,exitingModal:n,enteringModal:o}=this.props,{touchDown:i,dragging:a}=this.state;return e||n?H(O.Provider,{value:!0},H(Q.Provider,{value:this.modalRootContext},H(C,{className:T(vt,(null==(t=this.props.configProvider)?void 0:t.hasCustomPanelHeaderAfter)&&St,i&&T(Mt,"vkuiInternalModalRoot--touched"),!(!o&&!n)&&T(ft,"vkuiInternalModalRoot--switching")),onMove:this.onTouchMove,onEnd:this.onTouchEnd,onScroll:this.onScroll},H("div",{className:gt,onClick:this.props.onExit,ref:this.maskElementRef}),H("div",{className:Et,ref:this.viewportRef},this.getModals().map((t=>{const o=et(t.props),i=this.props.getModalState(o);if(o!==e&&o!==n||!i)return null;const s=l({},i),r=s.type===ut.PAGE;return H(at,{key:`modal-${o}`,getRootRef:t=>{const e=this.props.getModalState(o);e&&(e.modalElement=t)},onClose:this.props.onExit,timeout:this.timeout,className:T(xt,a&&"vkuiInternalModalRoot__modal--dragging",r&&s.expandable&&"vkuiInternalModalRoot__modal--expandable",r&&s.collapsed&&"vkuiInternalModalRoot__modal--collapsed"),restoreFocus:!1},t)})))))):null}})),function(t){const{platform:e}=g();return H(Pt,r(l({},t),{platform:e}))}),E,"configProvider");var Pt;function _t(t){var e,n,o,i,a,s,l;const{contentElement:r,bottomInset:d}=t,c=(null==r?void 0:r.firstElementChild).scrollHeight+((null==d?void 0:d.offsetHeight)||0);let u=t.translateY;t.expandable=c>(null!=(e=null==r?void 0:r.clientHeight)?e:0)||100===t.settlingHeight||t.expanded;let p,h,m,v,g,M=!1,f=!1;const E=Boolean(t.expandable&&100!==t.settlingHeight);if(t.expandable){p=100-(null!=(n=t.settlingHeight)?n:0);const e=p/2,o=100-p;m=[0,e],v=E?[e,p+o/4]:void 0,g=[p+o/4,100],M=E&&p>0,f=p<=0,h=p}else{p=100-(c+(null!=(i=null==(o=t.headerElement)?void 0:o.offsetHeight)?i:0))/(null!=(l=null==(s=null==(a=t.innerElement)?void 0:a.parentElement)?void 0:s.offsetHeight)?l:0)*100,h=p,m=[h,h+25],v=void 0,g=[h+25,h+100]}(t.expandable&&h>(null!=u?u:100)||100===t.settlingHeight)&&(h=0),0===h&&(f=!0,M=!1),t.expandedRange=m,t.collapsedRange=v,t.hiddenRange=g,t.translateY=h,t.translateYFrom=p,t.collapsed=M,t.expanded=f}const bt=({activeModal:t,children:e,onOpen:n,onOpened:o,onClose:i,onClosed:a})=>{const s=D(null),l=D(void 0),r=D(void 0),{document:c}=P(),{hasCustomPanelHeaderAfter:u,platform:p}=g(),{activeModal:h,exitingModal:m,onExit:v,getModalState:M,enteringModal:E,onEnter:y,onEntered:x,onExited:C,history:O,delayEnter:_}=mt(t,e,n,o,i,a,f),{waitTransitionFinish:b}=ot(),A=it({exitingModal:m,enteringModal:E,activeModal:h}),Y=lt({updateModalHeight:()=>{},registerModal:t=>{var e,n=t,{id:o}=n,i=d(n,["id"]);return Object.assign(null!=(e=M(o))?e:{},i)},onClose:v,isInsideModal:!0}),k=p===S.IOS?400:320,R=I.toArray(e),j=(t,e)=>{(null==t?void 0:t.innerElement)&&(t.innerElement.style.transition="",t.innerElement.style.transitionDelay=e&&_?`${k}ms`:"",t.innerElement.style.opacity=e?"1":"0")},L=(t,e=null)=>{null===e&&(null==O?void 0:O[0])!==t.id||(l.current&&cancelAnimationFrame(l.current),l.current=requestAnimationFrame((()=>{if(s.current){const{translateY:n=0,translateYCurrent:o=0}=t,i=null===e?1-(o-n)/(100-n)||0:e;s.current.style.opacity=w(i,0,100).toString()}})))};return F((()=>{var t;A&&(m&&m!==A.exitingModal&&(t=>{const e=M(t);e&&(h?C(t):requestAnimationFrame((()=>{b(null==e?void 0:e.innerElement,(()=>C(t)),k),j(e,!1),L(e,0)})))})(m),E&&E!==A.enteringModal&&(()=>{if(!E||!A)return;const t=M(E);y(),A.exitingModal?(requestAnimationFrame((()=>{(null==t?void 0:t.innerElement)&&(t.innerElement.style.transition="none",t.innerElement.style.opacity="1",L(t,1))})),x(E)):requestAnimationFrame((()=>{E==E&&(b(null==t?void 0:t.innerElement,(()=>x(E)),k),j(t,!0),t&&L(t,1))}))})(),h&&!A.activeModal&&(r.current=null!=(t=null==c?void 0:c.activeElement)?t:void 0),h||m||!r.current||(r.current.focus(),r.current=void 0))})),h||m?H(Q.Provider,{value:Y},H("div",{className:T(vt,u&&St,yt)},H("div",{className:gt,ref:s,onClick:v}),H("div",{className:Et},R.map((t=>{const e=et(t.props);if(e!==h&&e!==m)return null;return H(at,{restoreFocus:!1,onClose:v,timeout:k,key:`modal-${e}`,className:xt},t)}))))):null},At=t=>{const{isDesktop:e}=ct();_(!!t.activeModal);return H(e?bt:Ot,t)},Yt=$((()=>z((()=>import("./FullstackModal-dd78067a.js")),["assets/FullstackModal-dd78067a.js","assets/index-be53575a.js","assets/index-2e2e5bc2.css","assets/AppWrapper-57d4a081.js","assets/AppWrapper-0733cb84.css","assets/Button-d10c522b.js","assets/react_utils-d8a55a4d.js","assets/Button-e0c28a34.css","assets/useWaitTransitionFinish-c56c6461.js","assets/PanelHeaderButton-8251f36f.js","assets/App-6a17e3f9.js","assets/AppearanceProvider-695b2498.js","assets/AppearanceProvider-628e4cff.css","assets/App-b899851c.css","assets/PanelHeaderButton-09fcf9ff.css","assets/Subhead-dcba80aa.js","assets/Subhead-1c6aa1fb.css","assets/FocusTrap-b2106a9b.js","assets/FullstackModal-f9a1cff3.css"]))),kt=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=b(),{modal:e}=tt();return N(At,{activeModal:e,onClose:()=>t.hideModal(),children:N(Yt,{id:A})})}},Symbol.toStringTag,{value:"Module"}));export{ut as M,kt as i,ct as u};
